<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
<meta charset="UTF-8" />
<title>Check that album out.</title>
<link href="{{url_for('static',filename='index.css')}}" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}"/>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34519425-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type="text/javascript">var switchTo5x=true;</script>
<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript">stLight.options({publisher: "f187793e-d1ad-4240-8539-cc3e6cdec44f"}); </script>
</head>

<body>

<div class="formDiv">
<form id="userform"> <!--onsubmit="return submitForm();"-->
<fieldset>
<input class="submitText" type="text" name="name" />
<input class="submitBtn" type="submit" value="Search" onclick="return jsonParse();"/>
</fieldset>
<hr />
</form>
</div>

<div class="myDiv"><a href="http://album.onloop.net/"><img src="{{url_for('static',filename='logo.png')}}" alt="album.onloop"/></a><br />Content aggregator for Music Albums.<br /><hr/><i>Thanks to Google Search, Allmusic, RateYourMusic, Discogs, iTunes Store, Pitchfork, Sputnikmusic, Youtube and free information on the Web.</i><br/><i><b>Disclaimer:</b> I DO NOT own the content in the Search results. They belong to, and are scraped from, the aforementioned websites.</i><hr/><i>In case you missed the Watermark in the input box, an empty Search returns results on a random album. Also, the more elaborate the Search query is, the more relevant the results.</i></div>

<hr />

<p style="text-align:center;">
<span class='st_sharethis_hcount' displayText='ShareThis'></span>
<span class='st_facebook_hcount' displayText='Facebook'></span>
<span class='st_fblike_hcount' displayText='Facebook Like'></span>
<span class='st_twitter_hcount' displayText='Tweet'></span>
<span class='st_reddit_hcount' displayText='Reddit'></span>
<span class='st_plusone_hcount' displayText='Google +1'></span>
<span class='st_pinterest_hcount' displayText='Pinterest'></span><hr/>
<p style="text-align:center;"><a href="mailto:me@onloop.net">Mail</a> | <a href="http://onloop.net" onclick="window.open(this.href);return false;">Blog</a></p>
</p>

<p><br /></p>

<script type="text/javascript" src="{{url_for('static',filename='jquery-1.7.2.js')}}"></script>
<script type="text/javascript" src="{{url_for('static',filename='jquery.watermarkinput.js')}}"></script>
<script type="text/javascript">
	/*<![CDATA[*/
	var watermark = "Album/Soundtrack Search (Leave blank for random album.)";
	var requests;

	function htmlDecode(value){
		return $('<div/>').html(value).text();
	}

	function jsonParse() {
		var jsonFile = "{{url_for('static',filename='list_of_albums.json')}}";

		$.getJSON(jsonFile).success(function(data) {
				var randomIndex = Math.floor(Math.random() * data.albums.length/5);
				var randomString = data.albums[randomIndex];
				var decodedString = htmlDecode(randomString);
				var formData;
				formData = assignformString(decodedString);
				sendRequest(1, 7, formData);
				});
		return false;
	}

	function assignformString(albumChosen) {
		formString = $('#userform');
		var f = formString.serializeArray();
		if(f[0].value == "" || f[0].value == watermark) {
			f[0].value = albumChosen;
			$('.submitText').val(f[0].value);
			//formString = $('#userform');
		}
		return f[0].value;
	}


	function sendRequest(count, maxCount, formData) {
		if (count == 1) $('div.myDiv').html('<img class="loader" src="{{ url_for('static', filename='loader.gif') }}" alt="Fetching..." />');
		else $('div.myDiv').append('<img class="loader" src="{{ url_for('static', filename='loader.gif') }}" alt="Fetching..." />');

		if (requests) requests.abort();
		requests = $.ajax({type:'POST', url: '/', data:"&name=" + formData + "&count=" + count, success: function(response) {
				if (count == 1) { $('div.myDiv').html(response); }
				else { $('img.loader').replaceWith(response); }
					count++;
					if (count <= maxCount) {
						sendRequest(count, maxCount, formData);
					}
		}});

		return false;
	}

	//function submitForm() {
	//	formData = assignformString();
	//	sendRequest(1, 7, formData);
	//	return false;
	//}

	$('.submitText').ready(function(){
                jQuery(function($){
	        $('.submitText').Watermark(watermark);
		});
		
    		/*$(".submitBtn").attr("disabled", "true");
		$(".submitText").keyup(function(){
	        if ($(this).val() != "") {
        	    $(".submitBtn").removeAttr("disabled");
	        } else {
	            $(".submitBtn").attr("disabled", "true");        
	        }
	       });*/    
	});
	/*]]>*/
</script>

</body>
</html>
