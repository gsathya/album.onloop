<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
<meta charset="UTF-8" />
<title>Check that album out.</title>
<link href="{{url_for('static',filename='index.css')}}" rel="stylesheet" type="text/css"/>
</head>

<body>

<div class="formDiv">
<form id="userform"> <!--onsubmit="return submitForm();"-->
<fieldset>
<input class="submitText" type="text" name="name" />
<input class="submitBtn" type="submit" value="Submit" onclick="return jsonParse();"/>
</fieldset>
<hr />
</form>
</div>

<div class="myDiv"><a href="http://album.onloop.net/"><img src="{{url_for('static',filename='logo.jpg')}}" alt="album.onloop"/></a><br />Content aggregator for Music Albums.<br /><i>Thanks to Google Search, Allmusic, RateYourMusic, Discogs, iTunes Store.</i></div>

<hr />

<p style="text-align:center;">
<a href="mailto:me@onloop.net">Mail</a> | <a href="http://github.com/pranavrc/AlbumLore/" onclick="window.open(this.href);return false;">Fork</a> | <a href="" title="" onclick="window.open(this.href);return false;">What?</a>
</p>

<p><br /></p>

<script type="text/javascript" src="{{url_for('static',filename='jquery-1.7.2.js')}}"></script>
<script type="text/javascript" src="{{url_for('static',filename='jquery.watermarkinput.js')}}"></script>
<script type="text/javascript">
	/*<![CDATA[*/
	var watermark = "Album Search (Leave blank for random album.)";
	var requests;
	
	function jsonParse() {
		var jsonFile = "{{url_for('static',filename='list_of_albums.json')}}";

		$.getJSON(jsonFile).success(function(data) {
				var randomIndex = Math.floor(Math.random() * data.albums.length);
				var randomString = data.albums[randomIndex];
				var formData;
				formData = assignformString(randomString);
				sendRequest(1, 7, formData);
				});
		return false;
	}

	function assignformString(albumChosen) {
		formString = $('#userform');
		var f = formString.serializeArray();
		if(f[0].value == "" || f[0].value == watermark) {
			f[0].value = albumChosen;
			$('.submitText').val(f[0].value);
			//formString = $('#userform');
		}
		return f[0].value;
	}


	function sendRequest(count, maxCount, formData) {
		if (count == 1) $('div.myDiv').html('<img class="loader" src="{{ url_for('static', filename='loader.gif') }}" alt="Fetching..." />');
		else $('div.myDiv').append('<img class="loader" src="{{ url_for('static', filename='loader.gif') }}" alt="Fetching..." />');

		if (requests) requests.abort();
		requests = $.ajax({type:'POST', url: '/', data:"&name=" + formData + "&count=" + count, success: function(response) {
				if (count == 1) { $('div.myDiv').html(response); }
				else { $('img.loader').replaceWith(response); }
					count++;
					if (count <= maxCount) {
						sendRequest(count, maxCount, formData);
					}
		}});

		return false;
	}

	//function submitForm() {
	//	formData = assignformString();
	//	sendRequest(1, 7, formData);
	//	return false;
	//}

	$('.submitText').ready(function(){
                jQuery(function($){
	        $('.submitText').Watermark(watermark);
		});
		
    		/*$(".submitBtn").attr("disabled", "true");
		$(".submitText").keyup(function(){
	        if ($(this).val() != "") {
        	    $(".submitBtn").removeAttr("disabled");
	        } else {
	            $(".submitBtn").attr("disabled", "true");        
	        }
	       });*/    
	});
	/*]]>*/
</script>

</body>
</html>
